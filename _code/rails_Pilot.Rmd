---
title: "Instructions for analysing PAM data for SECO Pilot Studies"
---

```{r prep echo=TRUE include=FALSE}
library(here)
here()

source(here::here("_code/_common.R"))
```

This RMarkdown file is intended as a 'how to' for working with PAM data for the SECO Pilot Studies.

***To Do:***

-   Modify detection distance table

    -   Run

    -   Review data and create a function to identify

-   Soundscape

-   Biodiversity

-   Bats

-   Insects

# New Data

For new data, there are two RMarkdown files that need to be run on the new data.

First, we need to make modifications to the data IN PLACE. This code literally modifies the original data, so it must be used with caution, and run only once per dataset. This markdown file can be found here: **/\_code/newData_modifyInPlace.Rmd**

Next, we need to copy relevant data to our repository and modify it within the repository so that it is ready for downstream analyses. This markdown file can be found here: **/\_code/newData.Rmd**

At this point, the data should be ready for the analysis shown below.

# Create Detection Distance Data, Table

```{r rails-det-dist}
deployments_all <- readRDS(here("data/deployments.rds"))
# Extract reference coordinates for DD01 and DD02
ref1 <- deployments_all %>% filter(site == "DD01") %>% select(longitude, latitude) %>% as.numeric()
ref2 <- deployments_all %>% filter(site == "DD02") %>% select(longitude, latitude) %>% as.numeric()

dd <- as_tibble(deployments_all) %>%
  filter(location == "SPP-DD")%>%
  mutate(
    dist2SPP1 = distHaversine(cbind(longitude, latitude), ref1),
    dist2SPP2 = distHaversine(cbind(longitude, latitude), ref2)
  )
saveRDS(dd, file=here("data/deployTable_DD.rds"))

```

#Run Detection Explorer

```{r DetectionExplorer}
myNewData <- readRDS("file I want to work with.rds")
runDetectionExplorer(myNewData)#Will run shiny app

#Prep data in shiny app, then copy the specific code below
myData <- loadDetectionData(myNewData)

#and then apply to your plots by copying the code to 'copyCodeHere'
plotDetectionBoxplot(copyCodeHere)
plotPolarDetections(copyCodeHere)
plotAcousticScene(copyCodeHere)
```

# Soundscape

```{r soundscape}


```

# Biodiversity Indices

```{r biodiversity}
# First, select two separate 5 min file from TJE and from SGR for analysis

# For each dataset, run each of the analyses, below. Provide a means for comparison

# Acoustic Complexity Index (ACI, seewave)
ACI(wave, f, channel = 1, wl = 512, ovlp = 0,  wn = "hamming", flim = NULL, nbwindows = 1)

# Acoustic Diversity Index (ADI, SoundEcology)
# Soundecology Function = "acoustic_diversity". Minimum frequency = 0 kHz, maximum frequency = 10 kHz, FFT = 512, dB threshold = -50, Frequency band width = 1 kHz.
acoustic_diversity(soundfile, max_freq = 10000, db_threshold = -50, 
freq_step = 1000, shannon = TRUE)

# Bioacoustic Index (BI, SoundEcology)
# Soundecology Function = "bioacoustic_index". Minimum frequency = 2 kHz, maximum frequency = 8 kHz, FFT = 512. 
bioacoustic_index(soundfile, min_freq = 2000, max_freq = 8000, fft_w = 512)

# Acoustic Entropy Index
# Seewave Function = "H". Minimum frequency = 0 kHz, maximum frequency = Nyquist of recording, FFT = 512.
H(wave, f, channel = 1, wl = 512, envt="hil", msmooth = NULL, ksmooth = NULL)


```
