---
title: "Results"
format: html
---

To Do: 
- Summary of data at top (hours of recordings at each site, total Tb of data, # species detected)
- Create scrolling spectrograms using dynaSpec in R Here is a [link](https://colab.research.google.com/github/maRce10/dynaSpec/blob/master/dynaSpec.ipynb) to a colab notebook on this

```{r setup}
#| include: false
library(here)
library(jsonlite)


video_dir <- here("output", "videos")
video_files <- list.files(video_dir, pattern = "\\.(mp4|mov|webm)$", full.names = FALSE)

# Pass data to OJS using ojs_define
ojs_define(video_data = video_files)
```

```{ojs}
//| echo: false

// Use the data directly
videos = video_data

// Function to get MIME type from extension
function getMimeType(filename) {
  const ext = filename.split('.').pop().toLowerCase();
  const mimeTypes = {
    'mp4': 'video/mp4',
    'webm': 'video/webm',
    'mov': 'video/quicktime'
  };
  return mimeTypes[ext] || 'video/mp4';
}

// Create dropdown and video player with vanilla HTML
html`
  <div>
    <label for="video-select">Select a video:</label>
    <select id="video-select" style="margin: 10px 0; padding: 5px; font-size: 14px;">
      ${videos.map(v => `<option value="${v}">${v}</option>`).join('')}
    </select>
    
    <h4 id="now-playing">Now Playing: ${videos[0]}</h4>
    <video id="video-player" width="640" height="480" controls key="${videos[0]}">
      <source src="${"../../output/videos/" + videos[0]}" type="${getMimeType(videos[0])}">
      Your browser does not support the video tag.
    </video>
  </div>
  
  <script>
    (function() {
      const select = document.getElementById('video-select');
      const player = document.getElementById('video-player');
      const nowPlaying = document.getElementById('now-playing');
      
      select.addEventListener('change', function() {
        const selectedVideo = this.value;
        const ext = selectedVideo.split('.').pop().toLowerCase();
        const mimeTypes = {
          'mp4': 'video/mp4',
          'webm': 'video/webm',
          'mov': 'video/quicktime'
        };
        const mimeType = mimeTypes[ext] || 'video/mp4';
        
        // Update player source with correct relative path
        player.innerHTML = '<source src="../../output/videos/' + selectedVideo + '" type="' + mimeType + '">Your browser does not support the video tag.';
        nowPlaying.textContent = 'Now Playing: ' + selectedVideo;
        player.load();
        player.play().catch(e => console.log('Autoplay prevented'));
      });
    })();
  </script>
`
```